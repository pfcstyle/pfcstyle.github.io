<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>Read-Android-Blog &mdash; 01手记</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mzlogin/rouge-themes@master/dist/github.css"><link rel="canonical" href="https://pfcstyle.github.io/2016/11/07/Read-Android-Blog/"><link rel="alternate" type="application/atom+xml" title="01手记" href="https://pfcstyle.github.io/feed.xml"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/favicon.ico"><meta property="og:title" content="Read-Android-Blog"><meta name="keywords" content="["android", "blog"]"><meta name="og:keywords" content="["android", "blog"]"><meta name="description" content=" 站在巨人的肩膀上"><meta name="og:description" content=" 站在巨人的肩膀上"><meta property="og:url" content="https://pfcstyle.github.io/2016/11/07/Read-Android-Blog/"><meta property="og:site_name" content="01手记"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2016-11-07"> <script src="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/js/main.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://pfcstyle.github.io/" title="01手记"><span class="octicon octicon-mark-github"></span> 01手记</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://pfcstyle.github.io/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="https://pfcstyle.github.io/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="https://pfcstyle.github.io/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="https://pfcstyle.github.io/links/" class=" site-header-nav-item" target="" title="链接">链接</a> <a href="https://pfcstyle.github.io/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="Read-Android-Bl"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">Read-Android-Blog</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2016/11/07 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://pfcstyle.github.io/categories/#Android" title="Android">Android</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 3640 字，约 11 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><blockquote><p>站在巨人的肩膀上</p></blockquote><p>最近在<a href="http://gold.xitu.io/">掘金</a>上读了一些好的android blog,有些心得，总结一下。</p><h1 id="译开发安卓apps我所努力学习到的三十多条宝贵经验"><a href="http://yifeng.studio/2016/10/27/android-develop-30-things-that-experience-made-me-learn-the-hard-way/">［译］开发安卓Apps，我所努力学习到的三十多条宝贵经验</a></h1><p>其中的某些推荐博客需要翻墙才可浏览。</p><h3 id="选择与使用第三方库">选择与使用第三方库</h3><ol><li>你应该选择大众的选择，一是因为经得起考验，二是因为用的人多，总会用贡献者加入，作者维护起来也会更加用心。</li><li>选择可信的作者或者组织。</li><li>选择文档比较全面的。</li><li>选择专精某一功能的库，而不是大而全的库。否则这个库一旦停止维护，你可能要面临全部重构的危险。</li><li>使用第三方库时，你应该对其再次封装，防止在你的工程需要替换这个库的时候导致的大范围代码修改。</li><li>一定要理解第三方库的原理，但不到万不得已，一定不要修改第三方库！</li><li>应该养成积累自己的轮子的习惯。</li></ol><h3 id="避免过度绘制">避免过度绘制</h3><p>首先你要学会使用android的一个检测工具：<em>android手机=&gt;开发者选项=&gt;调试GPU强制渲染(Debug GPU Overdraw)</em> 打开此选项之后，你会发现自己的手机屏幕充满了各种色块,如下图：</p><p><img src="/img/post/2016-11-07/overdraw.png" alt="" /> 本图来源于https://riggaroo.co.za/optimizing-layouts-in-android-reducing-overdraw/</p><p>各种颜色的含义：</p><ul><li><strong>原色</strong>：没有过度绘制</li><li><strong>蓝色</strong>：<em>1xOverdraw</em>-绘制了2次</li><li><strong>绿色</strong>：<em>2xOverdraw</em>-绘制了3次</li><li><strong>粉色</strong>：<em>3xOverdraw</em>-绘制了4次</li><li><strong>红色</strong>：<em>4xOverdraw</em>-绘制了5次</li></ul><p>ok,现在已经知道了如何绘制，那么接下来就是如何fix</p><p>这个要根据具体的项目来解决，其实无非是一个原则，重复绘制的地方看如何避免绘制。一些常见的问题，比如你设置的背景色是否真的需要？你设置的背景图片，你的某些空间是否真的需要一直显示？还有，很重要的一点，你得有一个好的产品设计。 你可以从<a href="https://riggaroo.co.za/portfolio/book-dash-android-app/">这里</a>得到更多关于过度绘制的信息</p><h3 id="如何分包按功能">如何分包(按功能)</h3><p>这个，怎么说呢，各执一词，我从android转到ios,又从ios转回android,就我的经验来说，我觉得应该按照功能来分包更加的科学，如何分包，解决的无非是维护时如何快速寻找到目标的问题。显然，如果你按照功能模块进行分包，可以快速的定位一个区域，然后，在功能模块的包内，你再根据你选用的设计模式来分包，这样就能很快的找到你的目标。如果你是刚开始就按照设计模式分包，甚至按照控件分包，那么，等待你的，就是眼花缭乱。</p><h3 id="如何加快gradle的编译速度">如何加快gradle的编译速度</h3><p>现在的android的开发者大多都已经转到android studio阵营了，而且不得不承认，android studio比eclipse要更加专业，功能也更强大。但是，当你的项目大到一定程度时，每次要启动一次应用都会变得异常煎熬。</p><p>在项目根目录下的gradle.properties中加入：</p><div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//# The Gradle daemon aims to improve the startup and execution time of Gradle.</span>
<span class="c1">//# When set to true the Gradle daemon is to run the build.</span>
<span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">daemon</span><span class="o">=</span><span class="kc">true</span>

<span class="c1">//# Specifies the JVM arguments used for the daemon process.</span>
<span class="c1">//# The setting is particularly useful for tweaking memory settings.</span>
<span class="c1">//# Default value: -Xmx10248m -XX:MaxPermSize=256m</span>
<span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">jvmargs</span><span class="o">=-</span><span class="n">Xmx2048m</span> <span class="o">-</span><span class="nl">XX:</span><span class="n">MaxPermSize</span><span class="o">=</span><span class="mi">512</span><span class="n">m</span> <span class="o">-</span><span class="nl">XX:</span><span class="o">+</span><span class="n">HeapDumpOnOutOfMemoryError</span> <span class="o">-</span><span class="n">Dfile</span><span class="o">.</span><span class="na">encoding</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>

<span class="c1">//# When configured, Gradle will run in incubating parallel mode.</span>
<span class="c1">//# This option should only be used with decoupled projects. More details, visit</span>
<span class="c1">//# http://www.gradle.org/docs/current/userguide/multi_project_builds.html</span>
<span class="c1">//#sec:decoupled_projects</span>
<span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">parallel</span><span class="o">=</span><span class="kc">true</span>

<span class="c1">//# Enables new incubating mode that makes Gradle selective when configuring projects.</span>
<span class="c1">//# Only relevant projects are configured which results in faster builds for large multi-projects.</span>
<span class="c1">//# http://www.gradle.org/docs/current/userguide/multi_project_builds.html#sec:configuration_on_demand</span>
<span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">configureondemand</span><span class="o">=</span><span class="kc">true</span>

</code></pre></div></div><p>具体的原理我就不再记录了，不是我想关注的，如果你想要了解，请看<a href="https://medium.com/@cesarmcferreira/speeding-up-gradle-builds-619c442113cb#.n6fmf1pv6">这里</a>（需要梯子）</p><h3 id="svg-代替-png">SVG 代替 PNG</h3><p>当年xcode6开始支持pdf作为矢量图时，着实给我我们的UI省了一大把力，UI只需要确定一个屏幕尺寸，出一套pdf图给我们就可以了，xcode会自动生成3个尺寸的png给我们，而我们的调用仍然想以前一样简单。</p><p>现在我看到android也可以这样搞了，给我们一套svg或者psd的图，我们也可以自己生成其他尺寸的图，同样也是不会有任何锯齿的。不过遗憾的是4.4及以下的系统是不支持的，所以恐怕现在还是不能大范围使用的，毕竟5.0以下系统还不能直接抛弃。</p><h1 id="android-app优化之内存优化序"><a href="http://www.jianshu.com/p/48475df838d9">Android App优化之内存优化(序)</a></h1><p>至于说GC机制以及系统切换APP的内存管理机制，这里都不会解释，不懂得可以参考上述博文，写的很详细生动。</p><p>我要总结的是：<em>为了不要让系统kill掉我们的App, 可以从进程级别, 内存消耗量等几个方面进行优化。</em></p><h3 id="内存监测工具memory-monitor">内存监测工具Memory Monitor</h3><p><img src="/img/post/2016-11-07/memorymonitor.jpg" alt="一图看懂Memory Monitor" /> 此图来源于:http://blog.lmj.wiki/2016/10/25/app-opti/app_opt_mat/</p><ul><li>① GC按钮, 点击执行一次GC操作.</li><li>② Dump Java Heap按钮, 点击会在该调试工程的captures目录生成一个类似这样”com.anly.githubapp_2016.09.21_23.42.hprof”命名的hprof文件, 并打开Android Studio的HPROF Viewer显示该文件内容.</li><li>③ Allocation Traking按钮, 点击一次开始, 再次点击结束, 同样会在captrures目录生成一个文件, 类似”com.anly.githubapp_2016.09.21_23.48.alloc”, alloc后缀的文件, 并打开Allocation Tracker视图展示该文件内容.</li></ul><p>这里只简单提一下android studio自带的监测工具，具体使用，可以参照上面的博文系列。</p><h3 id="内存泄漏的常见可能">内存泄漏的常见可能</h3><ol><li><strong>Context泄漏</strong>。某些全局对象没有使用Application级别的对象，而是使用的指定的activity的Context，导致activity难以回收。</li><li><strong>内部类泄漏</strong>。当内部类持有当前类的引用，并且内部类的生命周期长与当前类，就会导致当前类的内存泄漏。如Handler泄露, Thread泄露等。其实，当我们发生这种错误时，一般lint会进行提示，并且建议我们使用使用Static + WeakReference的方式，这正是正确的解决方式，而不是使用@SuppressLint(“HandlerLeak”)来逃避提示。</li><li><strong>Register泄漏</strong>。对于观察者，广播，Listener等，添加与删除没有成对出现，从而导致的内存泄露，这个只能希望程序员们多长点心了。</li><li><strong>资源泄漏</strong>。当你操作文件或者数据库等等时，打开资源之后，请一定记得关闭资源。</li><li><strong>Bitmap泄漏</strong>。Bitmap没有及时的调用recycle()回收导致内存泄漏。</li></ol><h3 id="有效使用内存的建议">有效使用内存的建议</h3><ul><li>合理使用ServiceService的及时关闭可以让我们节省内存消耗, 对于一次性的任务, 建议使用IntentService.</li><li>使用优化后的数据容器使用Android提供的SparseArray, SparseBooleanArray, LongSparseArray来代替HashMap的使用.关于HashMap，ArrayMap，SparseArray, <a href="http://www.jianshu.com/p/7b9a1b386265">这篇文章</a>有个比较直观的比较, 可以看下.</li><li>少用枚举enum结构相比于静态常量(static final), enum会耗费双倍的内存.</li><li>避免创建不必要的对象诸如一些临时对象, 特别是循环中的.</li><li>考虑实现onTrimMemory(), 在此根据当前的内存状态做些处理.</li><li>Bitmap的合理有效使用.对于Bitmap的使用, 建议直接查看官方开发文档中的<a href="https://developer.android.com/training/displaying-bitmaps/index.html">高效显示Bitmap</a>(需翻墙).</li></ul><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="https://pfcstyle.github.io" target="_blank">Yawei Wang</a></li><li>本文链接：<a href="https://pfcstyle.github.io/2016/11/07/Read-Android-Blog/" target="_blank">https://pfcstyle.github.io/2016/11/07/Read-Android-Blog/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/2016/11/07/Read-Android-Blog/', clientID: 'e1a31f938861348e8751', clientSecret: 'd911850947298eb91753591eeb8dba129cc7fd86', repo: 'bomment', owner: 'pfcstyle', admin: ['pfcstyle'], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://pfcstyle.github.io/assets/search_data.json', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2015 <span title="Yawei Wang">Yawei Wang</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/pfcstyle/pfcstyle.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://pfcstyle.github.io/" title="首页" target="">首页</a></li><li> <a href="https://pfcstyle.github.io/categories/" title="分类" target="">分类</a></li><li> <a href="https://pfcstyle.github.io/wiki/" title="维基" target="">维基</a></li><li> <a href="https://pfcstyle.github.io/links/" title="链接" target="">链接</a></li><li> <a href="https://pfcstyle.github.io/about/" title="关于" target="">关于</a></li><li><a href="https://pfcstyle.github.io/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul><script async src="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/vendor/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> 本站访问量<span id="busuanzi_value_site_pv"></span>次 </span> <span id="busuanzi_container_site_uv" style="display:none"> / 本站访客数<span id="busuanzi_value_site_uv"></span>人 </span> <span id="busuanzi_container_page_pv" style="display:none"> / 本页访问量<span id="busuanzi_value_page_pv"></span>次 / 统计始于2020-05-03 </span></div></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script><div style="display:none"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-80669434-1', 'auto'); ga('send', 'pageview'); </script></div></body></html>
