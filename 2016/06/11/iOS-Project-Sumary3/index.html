<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>iOS项目总结(三) &mdash; 01手记</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mzlogin/rouge-themes@master/dist/github.css"><link rel="canonical" href="https://pfcstyle.github.io/2016/06/11/iOS-Project-Sumary3/"><link rel="alternate" type="application/atom+xml" title="01手记" href="https://pfcstyle.github.io/feed.xml"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/favicon.ico"><meta property="og:title" content="iOS项目总结(三)"><meta name="keywords" content="["iOS", "OC", "第三方登陆", "Google", "Facebook", "SDK"]"><meta name="og:keywords" content="["iOS", "OC", "第三方登陆", "Google", "Facebook", "SDK"]"><meta name="description" content=" 不积跬步，无以至千里；不积小流，无以成江海；"><meta name="og:description" content=" 不积跬步，无以至千里；不积小流，无以成江海；"><meta property="og:url" content="https://pfcstyle.github.io/2016/06/11/iOS-Project-Sumary3/"><meta property="og:site_name" content="01手记"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2016-06-11"> <script src="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/js/main.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://pfcstyle.github.io/" title="01手记"><span class="octicon octicon-mark-github"></span> 01手记</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://pfcstyle.github.io/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="https://pfcstyle.github.io/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="https://pfcstyle.github.io/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="https://pfcstyle.github.io/links/" class=" site-header-nav-item" target="" title="链接">链接</a> <a href="https://pfcstyle.github.io/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="iOS项目总结(三)"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">iOS项目总结(三)</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2016/06/11 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://pfcstyle.github.io/categories/#iOS" title="iOS">iOS</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 4751 字，约 14 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><blockquote><p>不积跬步，无以至千里；不积小流，无以成江海；</p></blockquote><p>前段时间做了一个新加坡的电商项目，要求添加Google和Facebook的第三方登陆支持，我看国内介绍不多，也不够详细，在这里介绍一下。</p><h1 id="facebook">Facebook</h1><p>先说下Facebook的，我发现Facebook竟然提供了中文版的<a href="https://developers.facebook.com/docs/ios/getting-started">新手入门文档</a>，所以大家也不用觉得难啃了，我在这里就简单说一下流程与我遇到的问题，大家参考上面的文档就好了(不要跟我讲翻不了墙，翻不了墙你还是不要集成了，集成了也登陆不上啊。。。)。</p><ul><li><strong>下载 SDK</strong></li><li><strong>创建 Facebook 应用</strong></li><li><strong>应用程序设置</strong></li><li><strong>添加 SDK</strong></li><li><strong>配置 Xcode</strong></li><li><strong>连接应用程序委托</strong></li><li><strong>添加应用事件</strong></li></ul><p>首先，在下载的SDK中是有一个示例工程的，所以大家如果遇到了什么解决不了的问题，可以去参考里面的示例工程。</p><p>仔细想想facebook好像没有遇到什么问题，大家按照上面来吧。如果遇到问题，可以在下面留言。如果大家只是需要集成登陆功能，只需要添加FBSDKCoreKit.framework和FBSDKLoginKit.framework即可。</p><h1 id="google">Google</h1><p>Google没有提供中文文档，我这里详细说一下流程。</p><h3 id="下载sdk">下载SDK</h3><p>首先去下载Googel的最新版<a href="https://developers.google.com/identity/sign-in/ios/sdk/">SDK</a>。下载完毕了，本页面不要关闭，一会儿还有用。下载的SDK中也是包含有可以直接运行的示例工程的，大家多做参考。</p><h3 id="添加sdk">添加SDK</h3><p>将SDK解压，加入到你的工程中，如下图：</p><p><img src="/img/post/2016-06-11/addsdk.png" alt="" /></p><h3 id="配置xcode">配置Xcode</h3><p>1.添加下面这些frameworks</p><ul><li>AddressBook.framework</li><li>SafariServices.framework</li><li>SystemConfiguration.framework</li><li>libz.tbd</li></ul><p>我只能说Google有点坑，libz.tbd在文档中没有提到。。。害得浪费我半天时间。所以还是使用pods好啊，可以自动帮你配置所需的依赖，但是我在使用pods的时候却无法下载Google的sdk,而且我确定我翻墙成功了，如果有朋友知道为什么，还请不吝赐教.</p><p>2.添加Objc linker flag到build setting</p><ul><li>Other Linker Flags: $(OTHER_LDFLAGS) -ObjC</li></ul><p><img src="/img/post/2016-06-11/addlink.png" alt="" /></p><p>3.注册你的app到<a href="https://console.developers.google.com/iam-admin/projects">管理中心</a></p><p>4.下载你的app的配置文件</p><p>在刚刚下载sdk的页面往下，可以获得你的app的配置文件</p><p><img src="/img/post/2016-06-11/getconfig1.png" alt="" /></p><p><img src="/img/post/2016-06-11/getconfig2.png" alt="" /></p><p><img src="/img/post/2016-06-11/getconfig3.png" alt="" /></p><p>那么这个config文件到底是什么的，其实它记录的是你的app的相关信息，其中最重要的是你的app的client_id和reserveclient_id.</p><p>5.添加URL scheme到你的项目</p><p><img src="/img/post/2016-06-11/getconfig4.png" alt="" /></p><p>好了，至此就算是配置完毕了，接下来可以写代码来调用Google的登陆了。</p><h1 id="google登陆的使用">Google登陆的使用</h1><p>1.在appdelegate.m中导入#import &lt;GoogleSignIn/GoogleSignIn.h&gt;</p><p>2.设置GGLContext</p><pre><code class="language-Objective-C">- (BOOL)application:(UIApplication *)application
didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
NSError* configureError;
[[GGLContext sharedInstance] configureWithError: &amp;configureError];
NSAssert(!configureError, @"Error configuring Google services: %@", configureError);

[GIDSignIn sharedInstance].delegate = self;

return YES;
}
</code></pre><p>3.实现回调</p><pre><code class="language-Objective-C">- (BOOL)application:(UIApplication *)app
openURL:(NSURL *)url
options:(NSDictionary *)options {
    return [[GIDSignIn sharedInstance] handleURL:url
    sourceApplication:options[UIApplicationOpenURLOptionsSourceApplicationKey]
    annotation:options[UIApplicationOpenURLOptionsAnnotationKey]];
}

//如果你是使用的iOS8或者更老的版本，使用下面的
//这里比较郁闷的是facebook只是提供了老版本的接口。。。没有提供上面的代理实现
//所以我最后都是用的下面的这个 索性没有出问题
- (BOOL)application:(UIApplication *)application
openURL:(NSURL *)url
sourceApplication:(NSString *)sourceApplication
annotation:(id)annotation {
return [[GIDSignIn sharedInstance] handleURL:url
sourceApplication:sourceApplication
annotation:annotation];
}
</code></pre><p>好的，那么问题来了，当你同时使用Google和Facebook时，如何判断是谁的回调呢？看解决方式</p><pre><code class="language-Objective-C">- (BOOL)application:(UIApplication *)application
openURL:(NSURL *)url
sourceApplication:(NSString *)sourceApplication
annotation:(id)annotation {
    if ([url.absoluteString rangeOfString:kGoogleReversedClientID].location != NSNotFound) {
        //Google的回调
        return [[GIDSignIn sharedInstance] handleURL:url
        sourceApplication:sourceApplication
        annotation:annotation];
    }else{//facebook的回调
        return [[FBSDKApplicationDelegate sharedInstance] application:application
        openURL:url
        sourceApplication:sourceApplication
        annotation:annotation
        ];

    }
}

</code></pre><p>sharesdk是不是也是用的这种方式呢？难道被我猜到了？嘿嘿。</p><p>4.好了，现在到你的登陆界面，正式使用登陆按钮</p><pre><code class="language-Objective-C">//实现代理
@interface ViewController : UIViewController &lt;GIDSignInUIDelegate&gt;

//在didload方法中设置代理
- (void)viewDidLoad {
[super viewDidLoad];

// TODO(developer) Configure the sign-in button look/feel

[GIDSignIn sharedInstance].uiDelegate = self;

// 不推荐使用自动登陆
/**
When users silently sign in, the Sign-In SDK automatically acquires access tokens and automatically refreshes them when necessary. If you need the access token and want the SDK to automatically handle refreshing it, you can use the getAccessTokenWithHandler: method. To explicitly refresh the access token, call the refreshAccessTokenWithHandler: method.
*/
//上面这段话是官网上的，大概是说如果你使用了自动登陆，你可以通过getAccessTokenWithHandler:
//这个函数获取access token并且让SDK自动更新access token,如果你想要立刻更新，你可以使用
//refreshAccessTokenWithHandler:
//[[GIDSignIn sharedInstance] signInSilently];
}
</code></pre><p>5.实现代理方法</p><pre><code class="language-Objective-C">//这些我就不再解释了  很好理解
// Stop the UIActivityIndicatorView animation that was started when the user
// pressed the Sign In button
- (void)signInWillDispatch:(GIDSignIn *)signIn error:(NSError *)error {
    [myActivityIndicator stopAnimating];
}

// Present a view that prompts the user to sign in with Google
- (void)signIn:(GIDSignIn *)signIn
    presentViewController:(UIViewController *)viewController {
    [self presentViewController:viewController animated:YES completion:nil];
}

// Dismiss the "Sign in with Google" view
- (void)signIn:(GIDSignIn *)signIn
    dismissViewController:(UIViewController *)viewController {
    [self dismissViewControllerAnimated:YES completion:nil];
}
</code></pre><p>6.自定义button</p><p>Google提供的button叫做GIDSignInButton，好吧，扯淡，把我也欺骗了，这货的父类是UIControl,当时知道真相的我眼泪掉下来（我在storyboard里翻了半天啊＝＝）。那么所谓的自定义就是设置这货的属性了。</p><pre><code class="language-Objective-C">//好吧 只有这俩属性 具体使用方式你们可以参考示例项目
// The layout style for the sign-in button.
// Possible values:
// - kGIDSignInButtonStyleStandard: 230 x 48 (default)
// - kGIDSignInButtonStyleWide:     312 x 48
// - kGIDSignInButtonStyleIconOnly: 48 x 48 (no text, fixed size)
@property(nonatomic, assign) GIDSignInButtonStyle style;

// The color scheme for the sign-in button.
// Possible values:
// - kGIDSignInButtonColorSchemeDark
// - kGIDSignInButtonColorSchemeLight (default)
@property(nonatomic, assign) GIDSignInButtonColorScheme colorScheme;
</code></pre><p>当然，我是一直坚信没有无法自定义的view的，请移步<a href="http://pfcstyle.me/2016/05/27/Ios-OC-Skills-Total/">iOS一些小技巧及小知识点总结</a>。</p><p>PS：后来我发现Google的登录按钮其实可以使用自己的按钮，你只需要在按钮事件中添加<code class="language-plaintext highlighter-rouge">[[GIDSignIn sharedInstance] signIn]</code>即可，当然，其他的代理仍然是需要实现的。</p><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="https://pfcstyle.github.io" target="_blank">Yawei Wang</a></li><li>本文链接：<a href="https://pfcstyle.github.io/2016/06/11/iOS-Project-Sumary3/" target="_blank">https://pfcstyle.github.io/2016/06/11/iOS-Project-Sumary3/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/2016/06/11/iOS-Project-Sumary3/', clientID: 'e1a31f938861348e8751', clientSecret: 'd911850947298eb91753591eeb8dba129cc7fd86', repo: 'bomment', owner: 'pfcstyle', admin: ['pfcstyle'], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://pfcstyle.github.io/assets/search_data.json', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2015 <span title="Yawei Wang">Yawei Wang</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/pfcstyle/pfcstyle.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://pfcstyle.github.io/" title="首页" target="">首页</a></li><li> <a href="https://pfcstyle.github.io/categories/" title="分类" target="">分类</a></li><li> <a href="https://pfcstyle.github.io/wiki/" title="维基" target="">维基</a></li><li> <a href="https://pfcstyle.github.io/links/" title="链接" target="">链接</a></li><li> <a href="https://pfcstyle.github.io/about/" title="关于" target="">关于</a></li><li><a href="https://pfcstyle.github.io/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul><script async src="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/vendor/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> 本站访问量<span id="busuanzi_value_site_pv"></span>次 </span> <span id="busuanzi_container_site_uv" style="display:none"> / 本站访客数<span id="busuanzi_value_site_uv"></span>人 </span> <span id="busuanzi_container_page_pv" style="display:none"> / 本页访问量<span id="busuanzi_value_page_pv"></span>次 / 统计始于2020-05-03 </span></div></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/gh/pfcstyle/pfcstyle.github.io@master/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script><div style="display:none"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-80669434-1', 'auto'); ga('send', 'pageview'); </script></div></body></html>
